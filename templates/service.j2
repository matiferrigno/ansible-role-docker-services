# Generated by Ansible
#   role: matiferrigno.docker-services

[Unit]
Description={{ svc.name }} docker service

[Service]
WorkingDirectory={{ svc.workdir }}

{% for cmd in item.systemd_exec_start_pre | default([]) %}
ExecStartPre={{ cmd }}
{% endfor %}
{% if not (item.systemd_exec_start_pre is defined) %}
ExecStartPre=-{{ docker_services_compose_path }} \
  {% for cf in compose_files | default([]) %} -f {{ cf }} {% endfor %} \
  pull
{% endif %}

{% for cmd in item.systemd_exec_start | default([]) %}
ExecStart={{ cmd }}
{% endfor %}
{% if not (item.systemd_exec_start is defined) %}
ExecStart={{ docker_services_compose_path }} \
  {% for cf in compose_files | default([]) %} -f {{ cf }} {% endfor %} \
  up
{% endif %}
{% for cmd in item.systemd_exec_start_post | default([]) %}
ExecStartPost={{ cmd }}
{% endfor %}

{% for cmd in item.systemd_exec_stop_pre | default([]) %}
ExecStopPre={{ cmd }}
{% endfor %}
{% if item.systemd_exec_stop is defined %}
ExecStop={{ systemd_exec_stop }}
{% else %}
ExecStop={{ docker_services_compose_path }} \
  {% for cf in compose_files | default([]) %} -f {{ cf }} {% endfor %} \
  down --remove-orphans
{% endif %}
{% for cmd in item.systemd_exec_stop_post | default([]) %}
ExecStopPost={{ cmd }}
{% endfor %}

{% if item.systemd_exec_reload is defined %}
ExecReload={{ systemd_exec_reload }}
{% else %}
ExecReload={{ docker_services_compose_path }} \
  {% for cf in compose_files | default([]) %} -f {{ cf }} {% endfor %} \
  up
{% endif %}

StandardInput={{ item.systemd_standard_input | default('tty-force') }}

[Install]
WantedBy=multi-user.target
